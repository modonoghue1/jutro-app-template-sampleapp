import React,{useLayoutEffect,useRef}from"react";import{deprecated}from"@jutro/prop-types";import{unmountComponentAtNode}from"react-dom";import PropTypes from"prop-types";import set from"lodash/set";import{useHistory}from"react-router-dom";import{buildRendererName,buildRendererTargetId,buildUnmounterName,extractRemoteScope,applyDevProps}from"../utils";import styles from"./MicroAppContainer.module.css";import{getWindowAsObject}from"../types";const getFunctionFromWindow=(functionName,defaultFunction)=>{const window=getWindowAsObject();return"function"==typeof window[functionName]?window[functionName]:defaultFunction},defaultRenderer=targetElementId=>{const remoteScope=extractRemoteScope(targetElementId),rendererName=buildRendererName(remoteScope);throw new Error(`The micro-app remote code for "${remoteScope}" failed to attach the renderer function "${rendererName}" to the window. Please check for previous errors in the console.`)},defaultUnmounter=targetElementId=>{const mountedElement=document.getElementById(targetElementId);mountedElement&&unmountComponentAtNode(mountedElement)};export const microAppContainerPropTypes={remoteScope:PropTypes.string.isRequired,props:PropTypes.shape({configOverrides:deprecated(PropTypes.objectOf(PropTypes.any),"7.0.0",'Nest "configOverrides" inside of the "jutro" prop instead'),launchPropOverrides:deprecated(PropTypes.objectOf(PropTypes.any),"7.0.0",'Nest "launchPropOverrides" inside of the "jutro" prop instead'),componentMapExtensions:deprecated(PropTypes.objectOf(PropTypes.elementType.isRequired),"7.0.0",'Nest "componentMapExtensions" inside of the "jutro" prop instead'),messageLoader:deprecated(PropTypes.objectOf(PropTypes.func),"7.0.0",'Nest "messageLoader" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.'),coreMessageLoader:deprecated(PropTypes.objectOf(PropTypes.func),"7.0.0",'Nest "coreMessageLoader" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.'),intlTextComponent:deprecated(PropTypes.objectOf(PropTypes.string),"7.0.0",'Nest "intlTextComponent" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.'),onAuthSessionExpired:deprecated(PropTypes.objectOf(PropTypes.func),"7.0.0",'Nest "onAuthSessionExpired" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.'),devProps:PropTypes.objectOf(PropTypes.any)})};export const MicroAppContainer=({remoteScope:remoteScope,props:props={}})=>{const _useRef$current=useRef({renderer:getFunctionFromWindow(buildRendererName(remoteScope),defaultRenderer),unmounter:getFunctionFromWindow(buildUnmounterName(remoteScope),defaultUnmounter)}).current,renderer=_useRef$current.renderer,unmounter=_useRef$current.unmounter,routerHistory=useHistory(),targetElementId=buildRendererTargetId(`${remoteScope}-${routerHistory.location.key}`);return useLayoutEffect((()=>{const microAppProps=((props,routerHistory)=>{const microAppProps=applyDevProps(null!=props?props:{});return set({...microAppProps},"jutro.routerBinding.shellHistory",routerHistory)})(props,routerHistory);return renderer(targetElementId,microAppProps),()=>unmounter(targetElementId)})),React.createElement("div",{id:targetElementId,className:styles.microAppContainer})};MicroAppContainer.displayName="MicroAppContainer",MicroAppContainer.propTypes=microAppContainerPropTypes,MicroAppContainer.__docgenInfo={description:"",methods:[],displayName:"MicroAppContainer",props:{props:{defaultValue:{value:"{}",computed:!1},type:{name:"shape",value:{configOverrides:{name:"custom",raw:"deprecated(\n    PropTypes.objectOf(PropTypes.any),\n    '7.0.0',\n    'Nest \"configOverrides\" inside of the \"jutro\" prop instead'\n)",description:"Overrides to the config values of the micro-app\n@deprecated",required:!1},launchPropOverrides:{name:"custom",raw:"deprecated(\n    PropTypes.objectOf(PropTypes.any),\n    '7.0.0',\n    'Nest \"launchPropOverrides\" inside of the \"jutro\" prop instead'\n)",description:"Overrides of the launchProps supplied to the start method of the micro-app\n@deprecated",required:!1},componentMapExtensions:{name:"custom",raw:"deprecated(\n    PropTypes.objectOf(PropTypes.elementType.isRequired),\n    '7.0.0',\n    'Nest \"componentMapExtensions\" inside of the \"jutro\" prop instead'\n)",description:"Extensions to the component map which will be resolved in metadata of the  micro-app\n@deprecated",required:!1},messageLoader:{name:"custom",raw:'deprecated(\n    PropTypes.objectOf(PropTypes.func),\n    \'7.0.0\',\n    \'Nest "messageLoader" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.\'\n)',description:"The function to load locale messages\n@deprecated",required:!1},coreMessageLoader:{name:"custom",raw:'deprecated(\n    PropTypes.objectOf(PropTypes.func),\n    \'7.0.0\',\n    \'Nest "coreMessageLoader" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.\'\n)',description:"The function to load core app locale messages\n@deprecated",required:!1},intlTextComponent:{name:"custom",raw:'deprecated(\n    PropTypes.objectOf(PropTypes.string),\n    \'7.0.0\',\n    \'Nest "intlTextComponent" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.\'\n)',description:"The tag to render text inside of react-intl <Formatted*> components; defaults to React.Fragment (https://formatjs.io/docs/react-intl/upgrade-guide-3x)\n@deprecated",required:!1},onAuthSessionExpired:{name:"custom",raw:'deprecated(\n    PropTypes.objectOf(PropTypes.func),\n    \'7.0.0\',\n    \'Nest "onAuthSessionExpired" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.\'\n)',description:"Callback for when auth session expiresß\n@deprecated",required:!1},devProps:{name:"objectOf",value:{name:"any"},description:"Props to be used only in dev mode",required:!1}}},required:!1,description:"The props to be passed to the renderer function, isolated here to avoid\nnaming conflicts with the MicroAppContainer props"},remoteScope:{type:{name:"string"},required:!0,description:"The name for the remote scope associated to this micro-app in Jutro configs"}}},MicroAppContainer.__docgenInfo={componentName:"MicroAppContainer",packageName:"@jutro/lab-preview-micro-app",description:"",displayName:"MicroAppContainer",methods:[],actualName:"MicroAppContainer",props:{remoteScope:{type:{name:"string"},required:!0,description:"The name for the remote scope associated to this micro-app in Jutro configs"},props:{type:{name:"shape",value:{configOverrides:{name:"objectOf",raw:"deprecated(PropTypes.objectOf(PropTypes.any), '7.0.0', 'Nest \"configOverrides\" inside of the \"jutro\" prop instead')",description:"Overrides to the config values of the micro-app\n@deprecated",required:!1,deprecationInfo:{version:"7.0.0",mapTo:"configOverrides"},value:{name:"any"}},launchPropOverrides:{name:"objectOf",raw:"deprecated(PropTypes.objectOf(PropTypes.any), '7.0.0', 'Nest \"launchPropOverrides\" inside of the \"jutro\" prop instead')",description:"Overrides of the launchProps supplied to the start method of the micro-app\n@deprecated",required:!1,deprecationInfo:{version:"7.0.0",mapTo:"launchPropOverrides"},value:{name:"any"}},componentMapExtensions:{name:"objectOf",raw:"deprecated(PropTypes.objectOf(PropTypes.elementType.isRequired), '7.0.0', 'Nest \"componentMapExtensions\" inside of the \"jutro\" prop instead')",description:"Extensions to the component map which will be resolved in metadata of the  micro-app\n@deprecated",required:!1,deprecationInfo:{version:"7.0.0",mapTo:"componentMapExtensions"},value:{name:"elementType"}},messageLoader:{name:"objectOf",raw:'deprecated(PropTypes.objectOf(PropTypes.func), \'7.0.0\', \'Nest "messageLoader" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.\')',description:"The function to load locale messages\n@deprecated",required:!1,deprecationInfo:{version:"7.0.0",mapTo:"messageLoader"},value:{name:"func"}},coreMessageLoader:{name:"objectOf",raw:'deprecated(PropTypes.objectOf(PropTypes.func), \'7.0.0\', \'Nest "coreMessageLoader" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.\')',description:"The function to load core app locale messages\n@deprecated",required:!1,deprecationInfo:{version:"7.0.0",mapTo:"coreMessageLoader"},value:{name:"func"}},intlTextComponent:{name:"objectOf",raw:'deprecated(PropTypes.objectOf(PropTypes.string), \'7.0.0\', \'Nest "intlTextComponent" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.\')',description:"The tag to render text inside of react-intl <Formatted*> components; defaults to React.Fragment (https://formatjs.io/docs/react-intl/upgrade-guide-3x)\n@deprecated",required:!1,deprecationInfo:{version:"7.0.0",mapTo:"intlTextComponent"},value:{name:"string"}},onAuthSessionExpired:{name:"objectOf",raw:'deprecated(PropTypes.objectOf(PropTypes.func), \'7.0.0\', \'Nest "onAuthSessionExpired" inside of the "launchPropOverrides" prop instead. In 7.0.0, "launchPropOverrides" will need to be moved inside the "jutro" prop.\')',description:"Callback for when auth session expiresß\n@deprecated",required:!1,deprecationInfo:{version:"7.0.0",mapTo:"onAuthSessionExpired"},value:{name:"func"}},devProps:{name:"objectOf",value:{name:"any"},description:"Props to be used only in dev mode",required:!1}}},required:!1,description:"The props to be passed to the renderer function, isolated here to avoid\nnaming conflicts with the MicroAppContainer props",defaultValue:{value:"{}",computed:!1}}}};