import _classCallCheck from"@babel/runtime-corejs3/helpers/classCallCheck";import _createClass from"@babel/runtime-corejs3/helpers/createClass";import _assertThisInitialized from"@babel/runtime-corejs3/helpers/assertThisInitialized";import _inherits from"@babel/runtime-corejs3/helpers/inherits";import _possibleConstructorReturn from"@babel/runtime-corejs3/helpers/possibleConstructorReturn";import _getPrototypeOf from"@babel/runtime-corejs3/helpers/getPrototypeOf";import _defineProperty from"@babel/runtime-corejs3/helpers/defineProperty";function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}import React,{Component}from"react";import PropTypes from"prop-types";import _ from"lodash";import{createContextConsumerHOC}from"@jutro/platform";import{extendWithBreakpointValues,getBreakpointPxValue,getBreakpoints}from"./breakpoint.utils";export const BreakpointTrackerContext=React.createContext("desktop");export function withBreakpoint(ComponentToWrap){return createContextConsumerHOC({component:ComponentToWrap,context:BreakpointTrackerContext,mapContextToProps:(existingProps,breakpoint)=>breakpoint})}export function renderWithBreakpoint(render){return window.__TEST__?render("desktop"):React.createElement(BreakpointTrackerContext.Consumer,null,(breakpoint=>render(breakpoint)))}let BreakpointTracker=function(_Component){_inherits(BreakpointTracker,Component);var _super=_createSuper(BreakpointTracker);function BreakpointTracker(...args){var _this;return _classCallCheck(this,BreakpointTracker),_this=_super.call(this,...args),_defineProperty(_assertThisInitialized(_this),"state",{}),_defineProperty(_assertThisInitialized(_this),"breakpoints",void 0),_defineProperty(_assertThisInitialized(_this),"resizeTimer",null),_defineProperty(_assertThisInitialized(_this),"throttleResize",(()=>{!_this.resizeTimer&&_this.props.delayMs&&(_this.resizeTimer=window.setTimeout(_this.handleResize,_this.props.delayMs))})),_defineProperty(_assertThisInitialized(_this),"handleResize",(()=>{_this.resizeTimer=null;const newBreakpoint=_this.getBreakpointFromWidth(document.documentElement.clientWidth);_this.state.breakpoint!==newBreakpoint&&_this.setState({breakpoint:newBreakpoint})})),_this}return _createClass(BreakpointTracker,[{key:"componentDidMount",value:function(){this.breakpoints=getBreakpoints(),window.addEventListener("resize",this.throttleResize),window.addEventListener("orientationchange",this.handleResize),this.setState({breakpoint:this.getBreakpointFromWidth(document.documentElement.clientWidth)})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.throttleResize),window.removeEventListener("orientationchange",this.handleResize)}},{key:"getBreakpointFromWidth",value:function(width){let breakpoint="desktop";const keys=Object.keys(this.breakpoints);return _.forEachRight(keys,(key=>{width<=this.breakpoints[key]&&(breakpoint=key)})),breakpoint}},{key:"render",value:function(){const breakpoint=this.state.breakpoint;return breakpoint?React.createElement(BreakpointTrackerContext.Provider,{value:breakpoint},this.props.children):null}}]),BreakpointTracker}();_defineProperty(BreakpointTracker,"propTypes",{delayMs:PropTypes.number}),_defineProperty(BreakpointTracker,"defaultProps",{delayMs:50}),_defineProperty(BreakpointTracker,"applyBreakpointOverrides",extendWithBreakpointValues),_defineProperty(BreakpointTracker,"getBreakpoints",getBreakpoints),_defineProperty(BreakpointTracker,"getBreakpointPxValue",getBreakpointPxValue);export{BreakpointTracker as default};renderWithBreakpoint.__docgenInfo={description:"",methods:[],displayName:"renderWithBreakpoint"},BreakpointTracker.__docgenInfo={description:"",methods:[{name:"getBreakpointFromWidth",docblock:null,modifiers:[],params:[{name:"width",optional:!1,type:{name:"number"}}],returns:{type:{name:"DeviceType"}}},{name:"throttleResize",docblock:null,modifiers:[],params:[],returns:{type:{name:"void"}}},{name:"handleResize",docblock:null,modifiers:[],params:[],returns:{type:{name:"void"}}}],displayName:"BreakpointTracker",props:{delayMs:{defaultValue:{value:"50",computed:!1},type:{name:"number"},required:!1,description:""}}},renderWithBreakpoint.__docgenInfo={componentName:"renderWithBreakpoint",packageName:"@jutro/layout",description:"",displayName:"renderWithBreakpoint",methods:[],actualName:"renderWithBreakpoint"},BreakpointTracker.__docgenInfo={componentName:"BreakpointTracker",packageName:"@jutro/layout",description:"",displayName:"BreakpointTracker",methods:[{name:"getBreakpointFromWidth",docblock:null,modifiers:[],params:[{name:"width",optional:!1,type:null}],returns:null}],actualName:"BreakpointTracker",props:{delayMs:{type:{name:"number"},required:!1,description:"",defaultValue:{value:"50",computed:!1}}}};