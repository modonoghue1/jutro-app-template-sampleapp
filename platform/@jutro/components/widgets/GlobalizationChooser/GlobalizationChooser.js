import _slicedToArray from"@babel/runtime-corejs3/helpers/slicedToArray";import React,{useContext,useState,useCallback,useMemo}from"react";import PropTypes from"prop-types";import{LocaleContext,LanguageContext,LocaleService,getNativeLocaleLanguage,TranslatorContext}from"@jutro/locale";import{Grid}from"@jutro/layout";import{intlMessageShape,deprecated}from"@jutro/prop-types";import{getConfigValue}from"@jutro/config";import{warning}from"@jutro/logger";import styles from"./GlobalizationChooser.module.css";import{messages}from"./GlobalizationChooser.messages.js";import{GlobalizationChooserStorybook}from"./GlobalizationChooserStorybook";import{DropdownSelectField}from"../inputs/DropdownSelectField/DropdownSelectField";const defaultLocaleLabel=messages.localeLabel,defaultLanguageLabel=messages.languageLabel,globalizationChooserPropTypes={className:PropTypes.string,containerStyle:PropTypes.string,innerStyle:PropTypes.string,localeId:PropTypes.string,languageId:PropTypes.string,localeValue:PropTypes.string,languageValue:PropTypes.string,languageLabelText:intlMessageShape,localeLabelText:intlMessageShape,availableLanguageValues:PropTypes.array,availableLocaleValues:PropTypes.array,onLocaleValueChange:PropTypes.func,onLanguageValueChange:PropTypes.func,renderLocaleLabel:PropTypes.func,renderLanguageLabel:PropTypes.func,showLocaleLabel:PropTypes.bool,showLanguageLabel:PropTypes.bool,showLocaleSelect:PropTypes.bool,showLanguageSelect:PropTypes.bool,style:PropTypes.object,storybookMode:deprecated(PropTypes.bool,"7.0.0"),readOnly:PropTypes.bool,skipPropagation:PropTypes.bool};export const GlobalizationChooser=({onLocaleValueChange:onLocaleValueChange,onLanguageValueChange:onLanguageValueChange,localeId:localeId,languageId:languageId,localeLabelText:localeLabelText,languageLabelText:languageLabelText,localeValue:localeValue=getDefaultLocale(),languageValue:languageValue=getDefaultLanguage(),availableLanguageValues:availableLanguageValues=getDefaultLanguages(),availableLocaleValues:availableLocaleValues=getDefaultLocales(),renderLocaleLabel:renderLocaleLabel=getNativeLocaleLanguage,renderLanguageLabel:renderLanguageLabel=getNativeLocaleLanguage,showLocaleLabel:showLocaleLabel,showLanguageLabel:showLanguageLabel,showLocaleSelect:showLocaleSelect,showLanguageSelect:showLanguageSelect,className:className,containerStyle:containerStyle,innerStyle:innerStyle,style:style={},storybookMode:storybookMode,readOnly:readOnly,skipPropagation:skipPropagation})=>{const translator=useContext(TranslatorContext);let availableLanguages=availableLanguageValues;getConfigValue("JUTRO_AUTH_ENABLED",!1)&&getConfigValue("JUTRO_TSM_ENABLED",!1)&&(availableLanguages=getDefaultLanguages(),warning('Reading language list from String Manager service. Ignoring "availableLanguageValues" property in app config'));const languageContext=useContext(LanguageContext),localeContext=useContext(LocaleContext),_useState=useState(LocaleService.getStoredLocale()),_useState2=_slicedToArray(_useState,2),activeLocale=_useState2[0],setActiveLocale=_useState2[1],resolvedLocale=useMemo((()=>skipPropagation?localeValue:activeLocale||localeValue),[activeLocale,localeValue,skipPropagation]),_useState3=useState(LocaleService.getStoredLanguage()),_useState4=_slicedToArray(_useState3,2),activeLanguage=_useState4[0],setActiveLanguage=_useState4[1],resolvedLanguage=useMemo((()=>skipPropagation?languageValue:activeLanguage||languageValue),[activeLanguage,languageValue,skipPropagation]),updateActiveLocale=useCallback((locale=>{LocaleService.setCurrentLocale(locale),null!=localeContext&&localeContext.localeOnChangeCallback&&localeContext.localeOnChangeCallback(locale)}),[]),handleOnLocaleChange=useCallback((newLocale=>{onLocaleValueChange&&onLocaleValueChange(newLocale),setActiveLocale(newLocale),skipPropagation||updateActiveLocale(newLocale)}),[localeContext,onLocaleValueChange,updateActiveLocale,skipPropagation]),updateActiveLanguage=useCallback((language=>{LocaleService.setCurrentLanguage(language),null!=languageContext&&languageContext.languageOnChangeCallback&&languageContext.languageOnChangeCallback(language)}),[]),handleOnLanguageChange=useCallback((newLanguage=>{onLanguageValueChange&&onLanguageValueChange(newLanguage),setActiveLanguage(newLanguage),skipPropagation||updateActiveLanguage(newLanguage)}),[languageContext,onLanguageValueChange,updateActiveLanguage,skipPropagation]),availableLanguageOptions=useMemo((()=>availableLanguages.map((value=>{const label=renderLanguageLabel(value.toLowerCase());return label?{value:value,label:label}:null})).filter((x=>x))),[availableLanguages,renderLanguageLabel]),availableLocaleOptions=useMemo((()=>availableLocaleValues.map((value=>{const label=renderLocaleLabel(value.toLowerCase());return label?{value:value,label:label}:null})).filter((x=>x))),[availableLocaleValues,renderLocaleLabel]),dropdownLanguageOptions=useMemo((()=>availableLanguageOptions.map((({value:value,label:label})=>({displayName:label,id:value})))),[availableLanguageOptions]),dropdownLocaleOptions=useMemo((()=>availableLocaleOptions.map((({value:value,label:label})=>({displayName:label,id:value})))),[availableLocaleOptions]),localeLabel=translator(localeLabelText),languageLabel=translator(languageLabelText);return storybookMode?React.createElement(GlobalizationChooserStorybook,{languageId:languageId,languageLabel:languageLabel,showLanguageLabel:showLanguageLabel,showLanguageSelect:showLanguageSelect,availableLanguageOptions:availableLanguageOptions,resolvedLanguage:resolvedLanguage,onLanguageChange:handleOnLanguageChange,localeId:localeId,localeLabel:localeLabel,showLocaleLabel:showLocaleLabel,showLocaleSelect:showLocaleSelect,availableLocaleOptions:availableLocaleOptions,resolvedLocale:resolvedLocale,onLocaleChange:handleOnLocaleChange,containerStyle:containerStyle,innerStyle:innerStyle,style:style}):React.createElement(Grid,{gap:"large",className:containerStyle,columns:["1fr"],repeat:2},showLanguageSelect&&React.createElement(DropdownSelectField,{label:languageLabel,hideLabel:!showLanguageLabel,availableValues:dropdownLanguageOptions,value:resolvedLanguage,onValueChange:handleOnLanguageChange,className:className,controlClassName:styles.globalizationChooser,id:languageId,readOnly:readOnly}),showLocaleSelect&&React.createElement(DropdownSelectField,{label:localeLabel,hideLabel:!showLocaleLabel,availableValues:dropdownLocaleOptions,value:resolvedLocale,onValueChange:handleOnLocaleChange,className:className,controlClassName:styles.globalizationChooser,id:localeId,readOnly:readOnly}))};GlobalizationChooser.propTypes=globalizationChooserPropTypes,GlobalizationChooser.defaultProps={showLocaleSelect:!0,showLanguageSelect:!0,languageId:"languageSelect",localeId:"localeSelect",localeLabelText:defaultLocaleLabel,languageLabelText:defaultLanguageLabel,showLocaleLabel:!0,showLanguageLabel:!0,storybookMode:!1,readOnly:!1,skipPropagation:!1};const getDefaultLocales=()=>{const availableLocales=LocaleService.getAvailableLocales(),defaultLocales=LocaleService.settings?LocaleService.settings.getAvailableLocales():[LocaleService.locale];return availableLocales||defaultLocales},getDefaultLanguages=()=>{const availableLanguages=LocaleService.getAvailableLanguages(),defaultLanguages=LocaleService.settings?LocaleService.settings.getAvailableLanguages():[LocaleService.locale];return availableLanguages||defaultLanguages},getDefaultLocale=()=>LocaleService.getCurrentLocale(),getDefaultLanguage=()=>LocaleService.getCurrentLanguage();GlobalizationChooser.__docgenInfo={description:"Component that allows the user to select the preferred application language and locale.\n\n@type {React.FC<PropTypes.InferProps<typeof globalizationChooserPropTypes>>}\n\n@metadataType element",methods:[],displayName:"GlobalizationChooser",props:{localeValue:{defaultValue:{value:"getDefaultLocale()",computed:!0},type:{name:"string"},required:!1,description:"Selected locale."},languageValue:{defaultValue:{value:"getDefaultLanguage()",computed:!0},type:{name:"string"},required:!1,description:"Selected language."},availableLanguageValues:{defaultValue:{value:"getDefaultLanguages()",computed:!0},type:{name:"array"},required:!1,description:"Languages available for selection."},availableLocaleValues:{defaultValue:{value:"getDefaultLocales()",computed:!0},type:{name:"array"},required:!1,description:"Locales available for selection."},renderLocaleLabel:{defaultValue:{value:"getNativeLocaleLanguage",computed:!0},type:{name:"func"},required:!1,description:"Render prop to display locale in options."},renderLanguageLabel:{defaultValue:{value:"getNativeLocaleLanguage",computed:!0},type:{name:"func"},required:!1,description:"Render prop to display language in options."},style:{defaultValue:{value:"{}",computed:!1},type:{name:"object"},required:!1,description:"Object containing the style overrides for component.  Used only in Storybook mode."},showLocaleSelect:{defaultValue:{value:"true",computed:!1},type:{name:"bool"},required:!1,description:"Flag for showing/hiding the locale select"},showLanguageSelect:{defaultValue:{value:"true",computed:!1},type:{name:"bool"},required:!1,description:"Flag for showing/hiding the language select"},languageId:{defaultValue:{value:"'languageSelect'",computed:!1},type:{name:"string"},required:!1,description:"Id of the language select element."},localeId:{defaultValue:{value:"'localeSelect'",computed:!1},type:{name:"string"},required:!1,description:"Id of the locale select element."},localeLabelText:{defaultValue:{value:"messages.localeLabel",computed:!0},type:{name:"custom",raw:"intlMessageShape"},required:!1,description:"Message key for the locale label."},languageLabelText:{defaultValue:{value:"messages.languageLabel",computed:!0},type:{name:"custom",raw:"intlMessageShape"},required:!1,description:"Message key for the language label."},showLocaleLabel:{defaultValue:{value:"true",computed:!1},type:{name:"bool"},required:!1,description:"Flag for showing or hiding locale label"},showLanguageLabel:{defaultValue:{value:"true",computed:!1},type:{name:"bool"},required:!1,description:"Flag for showing or hiding language label"},storybookMode:{defaultValue:{value:"false",computed:!1},type:{name:"custom",raw:"deprecated(PropTypes.bool, '7.0.0')"},required:!1,description:"Option for rendering using native HTML tags instead of Jutro components."},readOnly:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:"If set to true the dropdowns are readonly. Ignored in the storybook mode."},skipPropagation:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:"If set to true the config is not updated on value change and GlobalizationChooser becomes a controlled component."},className:{type:{name:"string"},required:!1,description:"Additional class names for component."},containerStyle:{type:{name:"string"},required:!1,description:"Additional class names for component container."},innerStyle:{type:{name:"string"},required:!1,description:"Additional class names for component inner container. Used only in Storybook mode."},onLocaleValueChange:{type:{name:"func"},required:!1,description:"Callback invoked on locale change."},onLanguageValueChange:{type:{name:"func"},required:!1,description:"Callback invoked on language change."}}},GlobalizationChooser.__docgenInfo={componentName:"GlobalizationChooser",packageName:"@jutro/components",description:"Component that allows the user to select the preferred application language and locale.",displayName:"GlobalizationChooser",methods:[],actualName:"GlobalizationChooser",metadataType:"element",props:{className:{type:{name:"string"},required:!1,description:"Additional class names for component."},containerStyle:{type:{name:"string"},required:!1,description:"Additional class names for component container."},innerStyle:{type:{name:"string"},required:!1,description:"Additional class names for component inner container. Used only in Storybook mode."},localeId:{type:{name:"string"},required:!1,description:"Id of the locale select element.",defaultValue:{value:"'localeSelect'",computed:!1}},languageId:{type:{name:"string"},required:!1,description:"Id of the language select element.",defaultValue:{value:"'languageSelect'",computed:!1}},localeValue:{type:{name:"string"},required:!1,description:"Selected locale.",defaultValue:{value:"getDefaultLocale()",computed:!0}},languageValue:{type:{name:"string"},required:!1,description:"Selected language.",defaultValue:{value:"getDefaultLanguage()",computed:!0}},languageLabelText:{type:{name:"union",value:[{name:"string"},{name:"shape",value:{id:{name:"string",required:!1},defaultMessage:{name:"string",required:!1},args:{name:"shape",value:{},required:!1}}}]},required:!1,description:"Message key for the language label.",defaultValue:{value:"messages.languageLabel",computed:!0}},localeLabelText:{type:{name:"union",value:[{name:"string"},{name:"shape",value:{id:{name:"string",required:!1},defaultMessage:{name:"string",required:!1},args:{name:"shape",value:{},required:!1}}}]},required:!1,description:"Message key for the locale label.",defaultValue:{value:"messages.localeLabel",computed:!0}},availableLanguageValues:{type:{name:"array"},required:!1,description:"Languages available for selection.",defaultValue:{value:"getDefaultLanguages()",computed:!0}},availableLocaleValues:{type:{name:"array"},required:!1,description:"Locales available for selection.",defaultValue:{value:"getDefaultLocales()",computed:!0}},onLocaleValueChange:{type:{name:"func"},required:!1,description:"Callback invoked on locale change."},onLanguageValueChange:{type:{name:"func"},required:!1,description:"Callback invoked on language change."},renderLocaleLabel:{type:{name:"func"},required:!1,description:"Render prop to display locale in options.",defaultValue:{value:"getNativeLocaleLanguage",computed:!0}},renderLanguageLabel:{type:{name:"func"},required:!1,description:"Render prop to display language in options.",defaultValue:{value:"getNativeLocaleLanguage",computed:!0}},showLocaleLabel:{type:{name:"bool"},required:!1,description:"Flag for showing or hiding locale label",defaultValue:{value:"true",computed:!1}},showLanguageLabel:{type:{name:"bool"},required:!1,description:"Flag for showing or hiding language label",defaultValue:{value:"true",computed:!1}},showLocaleSelect:{type:{name:"bool"},required:!1,description:"Flag for showing/hiding the locale select",defaultValue:{value:"true",computed:!1}},showLanguageSelect:{type:{name:"bool"},required:!1,description:"Flag for showing/hiding the language select",defaultValue:{value:"true",computed:!1}},style:{type:{name:"object"},required:!1,description:"Object containing the style overrides for component.  Used only in Storybook mode.",defaultValue:{value:"{}",computed:!1}},storybookMode:{type:{name:"bool"},required:!1,description:"@deprecated Option for rendering using native HTML tags instead of Jutro components.",defaultValue:{value:"false",computed:!1},deprecationInfo:{version:"7.0.0",mapTo:null}},readOnly:{type:{name:"bool"},required:!1,description:"If set to true the dropdowns are readonly. Ignored in the storybook mode.",defaultValue:{value:"false",computed:!1}},skipPropagation:{type:{name:"bool"},required:!1,description:"If set to true the config is not updated on value change and GlobalizationChooser becomes a controlled component.",defaultValue:{value:"false",computed:!1}}}};