import _extends from"@babel/runtime-corejs3/helpers/extends";import _classCallCheck from"@babel/runtime-corejs3/helpers/classCallCheck";import _createClass from"@babel/runtime-corejs3/helpers/createClass";import _assertThisInitialized from"@babel/runtime-corejs3/helpers/assertThisInitialized";import _get from"@babel/runtime-corejs3/helpers/get";import _inherits from"@babel/runtime-corejs3/helpers/inherits";import _possibleConstructorReturn from"@babel/runtime-corejs3/helpers/possibleConstructorReturn";import _getPrototypeOf from"@babel/runtime-corejs3/helpers/getPrototypeOf";import _defineProperty from"@babel/runtime-corejs3/helpers/defineProperty";function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}import React,{useContext}from"react";import InputMask from"react-input-mask";import PropTypes from"prop-types";import cx from"classnames";import{isValid as isValidDate,parse as parseDate,format as formatDate}from"date-fns";import isEmpty from"lodash/isEmpty";import{LocaleContext}from"@jutro/locale";import{getMessageProp}from"@jutro/platform";import{DateValue}from"../../values/DateValue";import{FieldComponent}from"../FieldComponent/FieldComponent";import{FieldIcon}from"../FieldComponent/FieldIcon";import{GenericSelectControl}from"../GenericSelectControl/GenericSelectControl";import{generateTimeIntervals,filterOptions,isInRange}from"./helpers";import{messages}from"./TimeField.messages";import styles from"./TimeField.module.css";const FORMAT_12H={type:"12h",format:"hh:mm a",placeholder:"12:00 AM",mask:"Hh:Mm aa"},FORMAT_24H={type:"24h",format:"HH:mm",placeholder:"00:00",mask:"Hh:Mm"};let TimeFieldInternal=function(_FieldComponent){_inherits(TimeFieldInternal,FieldComponent);var _super=_createSuper(TimeFieldInternal);function TimeFieldInternal(...args){var _this;return _classCallCheck(this,TimeFieldInternal),_this=_super.call(this,...args),_defineProperty(_assertThisInitialized(_this),"isValidOption",((value,selectValue,selectOptions)=>{const timeFormat=_this.props.timeFormat,format=_this.getTimeFormat(timeFormat).format,isValid=isValidDate(parseDate(value,format,new Date)),isExist=selectOptions.find((option=>option.value.toLowerCase()===value.toLowerCase()));return isValid&&!isExist})),_defineProperty(_assertThisInitialized(_this),"onValueChange",(option=>{if(!option)return void _this.notifyChange(void 0);const format=_this.getTimeFormat(_this.props.timeFormat).format,parsedValue=parseDate(option.value,format,new Date);_this.notifyChange({hour:parsedValue.getHours(),minute:parsedValue.getMinutes()})})),_this}return _createClass(TimeFieldInternal,[{key:"getPlaceholder",value:function(customPlaceholder){if(customPlaceholder){return(0,this.translator)(customPlaceholder)}const timeFormat=this.props.timeFormat;return this.getTimeFormat(timeFormat).placeholder}},{key:"getTimeFormat",value:function(timeFormat){const locale=this.props.locale;if(timeFormat===FORMAT_12H.type)return FORMAT_12H;if(timeFormat===FORMAT_24H.type)return FORMAT_24H;return[FORMAT_12H,FORMAT_24H].find((({format:format})=>{var _locale$formatLong;return format.includes(null===(_locale$formatLong=locale.formatLong)||void 0===_locale$formatLong?void 0:_locale$formatLong.time({width:"short"}))}))||FORMAT_24H}},{key:"getValidationMessages",value:function(value=this.getValue()){const _this$props=this.props,messageProps=_this$props.messageProps,min=_this$props.min,max=_this$props.max,isValid=isInRange(value,min,max),incorrectInput=getMessageProp("incorrectInput",messageProps,messages),validationMessages=_get(_getPrototypeOf(TimeFieldInternal.prototype),"getValidationMessages",this).call(this)||[];return!isValid&&isEmpty(validationMessages)?[this.translator(incorrectInput)]:validationMessages}},{key:"parseRawValue",value:function(value){if(!value)return"";const timeFormat=this.props.timeFormat,format=this.getTimeFormat(timeFormat).format,hour=value.hour,minute=value.minute,date=new Date(1970,0,1,hour,minute,0);return formatDate(date,format)}},{key:"parseValue",value:function(value){if(!value)return;const timeFormat=this.props.timeFormat,format=this.getTimeFormat(timeFormat).format,hour=value.hour,minute=value.minute,date=new Date(1970,0,1,hour,minute,0);return{value:formatDate(date,format),label:formatDate(date,format)}}},{key:"renderInput",value:function(inputProps){const _this$props2=this.props,value=_this$props2.value,disabled=_this$props2.disabled,placeholder=_this$props2.placeholder,timeFormat=_this$props2.timeFormat,controlClassName=_this$props2.controlClassName,id=_this$props2.id,testId=_this$props2.testId,mask=this.getTimeFormat(timeFormat).mask,fieldUniqueId=this.fieldUniqueId,ariaAutocomplete=inputProps["aria-autocomplete"],inputValue=inputProps.value,onFocus=inputProps.onFocus,onBlur=inputProps.onBlur,onChange=inputProps.onChange,selectedValue=this.parseRawValue(value),classes=cx(styles.input,{disabled:disabled},controlClassName);return React.createElement(InputMask,{mask:mask,formatChars:{H:"[0-2]",h:"[0-9]",M:"[0-5]",m:"[0-9]",a:"[AM|PM|am|pm]"},value:inputValue||selectedValue,onChange:event=>{const eventValue=event.target.value;eventValue===selectedValue||eventValue.replace("/_|s|:/","")||this.onValueChange(),onChange(event)},onFocus:onFocus,onBlur:onBlur,disabled:disabled||!1},(()=>React.createElement("input",{id:fieldUniqueId,"data-testid":testId||id,className:classes,"aria-autocomplete":ariaAutocomplete,placeholder:this.getPlaceholder(placeholder),disabled:disabled||!1,type:"text"})))}},{key:"renderControlReadOnly",value:function(){const _this$props3=this.props,id=_this$props3.id,value=_this$props3.value,classes=cx(styles.readOnly);if(!value)return React.createElement(DateValue,{id:id,className:classes,onlyTime:!0});const hour=value.hour,minute=value.minute;return React.createElement(DateValue,{id:id,className:classes,value:new Date(1970,0,1,hour,minute),onlyTime:!0})}},{key:"renderComponent",value:function(props,options){const id=props.id,value=props.value,min=props.min,max=props.max,disabled=props.disabled,timeFormat=props.timeFormat,_props$timeIntervals=props.timeIntervals,timeIntervals=void 0===_props$timeIntervals?30:_props$timeIntervals,isInitiallyOpen=props.isInitiallyOpen,format=this.getTimeFormat(timeFormat).format,selectedValue=this.parseValue(value),availableValues=generateTimeIntervals(timeIntervals||30,format,min,max),inputElement=React.createElement(GenericSelectControl,{id:id,value:selectedValue,availableValues:availableValues,allowNewValue:this.isValidOption,filter:filterOptions,getOptionLabel:option=>option.label,getOptionValue:option=>option.value,onValueChange:this.onValueChange,valid:options.isValid,disabled:disabled,components:{DropdownIndicator:()=>null,IndicatorSeparator:()=>null,Value:()=>null,Placeholder:()=>null,ClearIndicator:()=>null,Input:inputProps=>this.renderInput(inputProps)},isInitiallyOpen:isInitiallyOpen,noOptionsMessage:null,createNewMessage:"{message}",controlShouldRenderValue:!1,backspaceRemovesValue:!1,isClearable:!0}),icon=props.icon,iconPosition=props.iconPosition;return React.createElement(FieldIcon,{icon:icon,iconPosition:iconPosition,disabled:disabled},inputElement)}},{key:"renderControl",value:function(breakpointProps,options){return this.renderComponent(breakpointProps,options)}}]),TimeFieldInternal}();export const TimeField=props=>{const dateLocale=useContext(LocaleContext).dateLocale;return React.createElement(TimeFieldInternal,_extends({locale:dateLocale},props))};TimeField.displayName="TimeField",TimeField.propTypes={...FieldComponent.propTypes,...FieldIcon.propTypes,value:PropTypes.shape({hour:PropTypes.number.isRequired,minute:PropTypes.number.isRequired}),min:PropTypes.oneOfType([PropTypes.shape({hour:PropTypes.number.isRequired,minute:PropTypes.number.isRequired}),PropTypes.bool]),max:PropTypes.oneOfType([PropTypes.shape({hour:PropTypes.number.isRequired,minute:PropTypes.number.isRequired}),PropTypes.bool]),timeIntervals:PropTypes.number,timeFormat:PropTypes.oneOf(["12h","24h"])},TimeField.defaultProps={...FieldComponent.defaultProps,icon:"gw-access-time",iconPosition:"right",timeIntervals:30},TimeField.__docgenInfo={description:"",methods:[],displayName:"TimeField",props:{icon:{defaultValue:{value:"'gw-access-time'",computed:!1},required:!1},iconPosition:{defaultValue:{value:"'right'",computed:!1},required:!1},timeIntervals:{defaultValue:{value:"30",computed:!1},type:{name:"number"},required:!1,description:"Time intervals for input preselected values"},value:{type:{name:"shape",value:{hour:{name:"number",required:!0},minute:{name:"number",required:!0}}},required:!1,description:"Time to display"},min:{type:{name:"union",value:[{name:"shape",value:{hour:{name:"number",required:!0},minute:{name:"number",required:!0}}},{name:"bool"}]},required:!1,description:"Min time"},max:{type:{name:"union",value:[{name:"shape",value:{hour:{name:"number",required:!0},minute:{name:"number",required:!0}}},{name:"bool"}]},required:!1,description:"Max time"},timeFormat:{type:{name:"enum",value:[{value:"'12h'",computed:!1},{value:"'24h'",computed:!1}]},required:!1,description:"Time format"}},composes:["../FieldComponent/FieldComponent","../FieldComponent/FieldIcon"]},TimeField.__docgenInfo={componentName:"TimeField",packageName:"@jutro/components",description:"",displayName:"TimeField",methods:[],actualName:"TimeField",props:{value:{type:{name:"shape",value:{hour:{name:"number",required:!0},minute:{name:"number",required:!0}}},required:!1,description:"Time to display"},min:{type:{name:"union",value:[{name:"shape",value:{hour:{name:"number",required:!0},minute:{name:"number",required:!0}}},{name:"bool"}]},required:!1,description:"Min time"},max:{type:{name:"union",value:[{name:"shape",value:{hour:{name:"number",required:!0},minute:{name:"number",required:!0}}},{name:"bool"}]},required:!1,description:"Max time"},timeIntervals:{type:{name:"number"},required:!1,description:"Time intervals for input preselected values",defaultValue:{value:"30",computed:!1}},timeFormat:{type:{name:"enum",value:[{value:"'12h'",computed:!1},{value:"'24h'",computed:!1}]},required:!1,description:"Time format"},icon:{defaultValue:{value:"'gw-access-time'",computed:!1},required:!1},iconPosition:{defaultValue:{value:"'right'",computed:!1},required:!1}},composes:["../FieldComponent/FieldComponent","../FieldComponent/FieldIcon"]};