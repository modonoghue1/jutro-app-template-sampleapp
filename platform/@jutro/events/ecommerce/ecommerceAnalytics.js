import _ from"lodash";import{subscribe}from"../EventProvider";import loadGA from"../ga";import ECOMMERCE_TOPICS from"./ecommerceTopics";function toList(items){return _.isArray(items)?items:[items]}export default function initializeEnhancedEcommerce(gaOrTrackingId){const ga=_.isFunction(gaOrTrackingId)?gaOrTrackingId:loadGA(gaOrTrackingId);function sendCheckoutOptionAdd({actionProps:actionProps,eventProps:eventProps,hitCallback:hitCallback}){ga("ec:setAction","checkout_option",actionProps),ga("send",{hitType:"event",eventCategory:(null==eventProps?void 0:eventProps.eventCategory)||"Checkout",eventAction:(null==eventProps?void 0:eventProps.eventAction)||"Option",eventLabel:null==eventProps?void 0:eventProps.eventLabel},{hitCallback:hitCallback})}ga("require","ec"),subscribe(ECOMMERCE_TOPICS.PRODUCT_VIEW,(({productImpressions:productImpressions})=>(toList(productImpressions).forEach((impression=>ga("ec:addImpression",impression))),void ga("send","pageview")))),subscribe(ECOMMERCE_TOPICS.PRODUCT_LINK_CLICK,(({products:products,actionProps:actionProps,eventProps:eventProps})=>function({product:product,actionProps:actionProps,eventProps:eventProps,hitCallback:hitCallback}){ga("ec:addProduct",product),ga("ec:setAction","click",actionProps),ga("send",{hitType:"event",eventCategory:(null==eventProps?void 0:eventProps.eventCategory)||"EC",eventAction:(null==eventProps?void 0:eventProps.eventAction)||"click",eventLabel:null==eventProps?void 0:eventProps.eventLabel},{hitCallback:hitCallback})}({products:products,actionProps:actionProps,eventProps:eventProps}))),subscribe(ECOMMERCE_TOPICS.PRODUCT_DETAIL_VIEW,(({products:products})=>function({product:product}){ga("ec:addProduct",product),ga("ec:setAction","detail"),ga("send","pageview")}({products:products}))),subscribe(ECOMMERCE_TOPICS.CART_ADD,(({products:products,actionProps:actionProps,eventProps:eventProps})=>function({products:products,actionProps:actionProps,eventProps:eventProps,hitCallback:hitCallback}){toList(products).forEach((product=>ga("ec:addProduct",product))),ga("ec:setAction","add",actionProps),ga("send",{hitType:"event",eventCategory:(null==eventProps?void 0:eventProps.eventCategory)||"EC",eventAction:(null==eventProps?void 0:eventProps.eventAction)||"click",eventLabel:null==eventProps?void 0:eventProps.eventLabel},{hitCallback:hitCallback})}({products:products,actionProps:actionProps,eventProps:eventProps}))),subscribe(ECOMMERCE_TOPICS.CART_REMOVE,(({products:products,actionProps:actionProps,eventProps:eventProps})=>function({products:products,actionProps:actionProps,eventProps:eventProps,hitCallback:hitCallback}){toList(products).forEach((product=>ga("ec:addProduct",product))),ga("ec:setAction","remove",actionProps),ga("send",{hitType:"event",eventCategory:(null==eventProps?void 0:eventProps.eventCategory)||"EC",eventAction:(null==eventProps?void 0:eventProps.eventAction)||"click",eventLabel:null==eventProps?void 0:eventProps.eventLabel},{hitCallback:hitCallback})}({products:products,actionProps:actionProps,eventProps:eventProps}))),subscribe(ECOMMERCE_TOPICS.CHECKOUT_STEP_VIEW,(({products:products,actionProps:actionProps})=>function({products:products,actionProps:actionProps}){toList(products).forEach((product=>ga("ec:addProduct",product))),ga("ec:setAction","checkout",actionProps),ga("send","pageview")}({products:products,actionProps:actionProps}))),subscribe(ECOMMERCE_TOPICS.CHECKOUT_OPITION_ADD,(({products:products,actionProps:actionProps,eventProps:eventProps})=>sendCheckoutOptionAdd({products:products,actionProps:actionProps,eventProps:eventProps}))),subscribe(ECOMMERCE_TOPICS.CHECKOUT_OPITION_ADD,(({products:products,actionProps:actionProps,eventProps:eventProps})=>sendCheckoutOptionAdd({products:products,actionProps:actionProps,eventProps:eventProps}))),subscribe(ECOMMERCE_TOPICS.PURCHASE_VIEW,(({products:products,actionProps:actionProps})=>function({products:products,actionProps:actionProps}){toList(products).forEach((product=>ga("ec:addProduct",product))),ga("ec:setAction","purchase",actionProps),ga("send","pageview")}({products:products,actionProps:actionProps})))}