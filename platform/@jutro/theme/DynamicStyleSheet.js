import _classCallCheck from"@babel/runtime-corejs3/helpers/classCallCheck";import _createClass from"@babel/runtime-corejs3/helpers/createClass";import{log}from"@jutro/logger";export let DynamicStyleSheet=function(){function DynamicStyleSheet(){_classCallCheck(this,DynamicStyleSheet)}return _createClass(DynamicStyleSheet,[{key:"mount",value:function(name="dynamicStyleSheet"){this.styleTag?log.warning(`Dynamic stylesheet was already mounted: '${name}'`):(this.name=name,this.styleTag=this.createStyleTag(name))}},{key:"unmount",value:function(){this.styleTag?(this.removeStyleTag(this.styleTag),this.styleTag=null):log.warning(`Dynamic stylesheet was already unmounted: '${this.name}'`)}},{key:"createStyleTag",value:function(name){if(Array.from(document.querySelectorAll("style")).some((style=>style.title===name)))return;const style=document.createElement("style");return style.setAttribute("title",name),style.setAttribute("type","text/css"),style.appendChild(document.createTextNode("")),document.head.appendChild(style),style}},{key:"removeStyleTag",value:function(styleTag){document.head.removeChild(styleTag)}},{key:"getStyleSheet",value:function(){return this.styleTag?this.styleTag.sheet:{}}},{key:"findRuleIndex",value:function(selector){const sheet=this.getStyleSheet();return Array.from(sheet.cssRules).findIndex((rule=>rule.selectorText===selector))}},{key:"addRule",value:function(selector,properties){const sheet=this.getStyleSheet(),ruleIndex=this.findRuleIndex(selector);-1!==ruleIndex&&sheet.deleteRule(ruleIndex);const rulePosition=-1===ruleIndex?sheet.cssRules.length:ruleIndex,propertyStrings=Object.keys(properties).map((propertyKey=>`${propertyKey}: ${properties[propertyKey]}`)).join("; ");sheet.insertRule?sheet.insertRule(`${selector} { ${propertyStrings} }`,rulePosition):sheet.addRule&&sheet.addRule(selector,propertyStrings,rulePosition)}},{key:"applyRules",value:function(styleRules){this.styleTag&&styleRules&&styleRules.forEach((({selector:selector,properties:properties})=>this.addRule(selector,properties)))}}]),DynamicStyleSheet}();