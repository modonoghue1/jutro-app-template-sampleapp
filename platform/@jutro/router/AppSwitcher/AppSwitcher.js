import _slicedToArray from"@babel/runtime-corejs3/helpers/slicedToArray";import React,{useContext,useState,useMemo,useCallback}from"react";import PropTypes from"prop-types";import{intlMessageShape,appSwitcherRoutePropTypes,appSwitcherRouteGroupPropTypes,separatorPropType}from"@jutro/prop-types";import{TranslatorContext}from"@jutro/locale";import cx from"classnames";import{uniqueInnerId}from"@jutro/platform";import{Popover,PopoverContainer,Link,InputField}from"@jutro/components";import{AppSwitcherButton,availableIconColors}from"./AppSwitcherButton";import{AppSwitcherContent}from"./AppSwitcherContent";import{isGroup,isApp}from"./helpers";import styles from"./AppSwitcher.module.css";import{messages}from"./AppSwitcher.messages";const appSwitcherPropTypes={id:PropTypes.string.isRequired,items:PropTypes.arrayOf(PropTypes.oneOfType([appSwitcherRoutePropTypes,appSwitcherRouteGroupPropTypes,separatorPropType]).isRequired).isRequired,className:PropTypes.string,onRouteClick:PropTypes.func,iconColor:PropTypes.oneOf(availableIconColors),iconClassName:PropTypes.string,footerText:intlMessageShape,footerUrl:intlMessageShape,onFooterClick:PropTypes.func,searchEnabled:PropTypes.bool,collapsibleGroupsThreshold:PropTypes.number,hideFooter:PropTypes.bool};function renderLink({label:label,onClick:onClick,href:href}){if(!label||!onClick&&!href)return null;const props={children:label,href:href,onClick:onClick};return React.createElement(Link,props)}export const AppSwitcher=({id:id,className:className,items:items,onRouteClick:onRouteClick,iconColor:iconColor,iconClassName:iconClassName,footerText:footerText,footerUrl:footerUrl,onFooterClick:onFooterClick,isDropdown:isDropdown,searchEnabled:searchEnabled,collapsibleGroupsThreshold:collapsibleGroupsThreshold,hideFooter:hideFooter})=>{const translator=useContext(TranslatorContext),_useState=useState(""),_useState2=_slicedToArray(_useState,2),searchPhrase=_useState2[0],setSearchPhrase=_useState2[1],containerClasses=cx(styles.appSwitcher,className),AppSwitcherButtonId=uniqueInnerId(id,["button"]).button,itemsCount=useMemo((()=>items.reduce(((numberOfItems,item)=>numberOfItems+(isGroup(item)?item.items.length+1:0)+(isApp(item)?1:0)),0)),[items]),itemsWithId=useMemo((()=>items.map(((item,index)=>{const itemId=`${index}`;return isGroup(item)?{...item,items:item.items.map(((itemInner,indexInner)=>({...itemInner,id:`${itemId}_${indexInner}`}))),id:itemId}:{...item,id:itemId}}))),[items]),matchesSearchPhrase=app=>{const translatedTitle=translator(app.title);return"string"==typeof translatedTitle&&translatedTitle.toLowerCase().includes(searchPhrase.toLowerCase())},filteredItems=useMemo((()=>searchPhrase?itemsWithId.reduce(((apps,item)=>(isGroup(item)&&item.items.forEach((app=>{matchesSearchPhrase(app)&&apps.push(app)})),isApp(item)&&matchesSearchPhrase(item)&&apps.push(item),apps)),[]):itemsWithId),[searchPhrase,itemsWithId]),footerLinkProps={label:footerText||"",href:footerUrl,onClick:event=>{onFooterClick&&onFooterClick(event),onRouteClick&&onRouteClick()}},handleRenderTrigger=useCallback(((toggle,ref,hasShownPopover)=>React.createElement(AppSwitcherButton,{id:AppSwitcherButtonId,togglePopover:toggle,ref:ref,hasShownPopover:hasShownPopover,iconColor:iconColor,iconClassName:iconClassName})),[AppSwitcherButtonId,iconClassName,iconColor]),displaySearch=searchEnabled&&itemsCount>=collapsibleGroupsThreshold,onSearchValueChange=newValue=>{setSearchPhrase(newValue)},resetSearch=()=>{setSearchPhrase("")},renderSearch=()=>React.createElement(InputField,{id:"app-switcher-search",placeholder:translator(messages.searchPlaceholder),icon:"gw-search",iconPosition:"right",value:searchPhrase,onValueChange:onSearchValueChange,className:styles.appSwitcherSearch}),lessThanCollapsibleGroupsThreshold=itemsCount<collapsibleGroupsThreshold,renderContent=closePopover=>React.createElement(AppSwitcherContent,{items:filteredItems,displaySearch:displaySearch,renderSearch:renderSearch,resetSearch:resetSearch,onRouteClick:onRouteClick,closePopover:closePopover,isCollapsible:!lessThanCollapsibleGroupsThreshold});return isDropdown?React.createElement(Popover,{id:id,renderTrigger:handleRenderTrigger,isFlipEnabled:!1,className:containerClasses},(closePopover=>React.createElement(PopoverContainer,{className:styles.appSwitcherPopoverContainer,hideFooter:hideFooter,hideHeader:!0,internalClassNames:{body:styles.appSwitcherPopoverBody,footer:styles.appSwitcherPopoverFooter},footerLink:footerLinkProps},renderContent(closePopover)))):React.createElement(React.Fragment,null,React.createElement("div",{className:className},renderContent()),!hideFooter&&React.createElement("div",{className:styles.footerModal},renderLink(footerLinkProps)))};AppSwitcher.displayName="AppSwitcher",AppSwitcher.propTypes=appSwitcherPropTypes,AppSwitcher.defaultProps={isDropdown:!0,searchEnabled:!0,items:[],collapsibleGroupsThreshold:15,hideFooter:!1},AppSwitcher.__docgenInfo={description:"",methods:[],displayName:"AppSwitcher",props:{isDropdown:{defaultValue:{value:"true",computed:!1},required:!1},searchEnabled:{defaultValue:{value:"true",computed:!1},type:{name:"bool"},required:!1,description:"Enables apps search field if the number of items equals or is above `collapsibleGroupsThreshold` value"},items:{defaultValue:{value:"[]",computed:!1},type:{name:"arrayOf",value:{name:"union",value:[{name:"custom",raw:"appSwitcherRoutePropTypes"},{name:"custom",raw:"appSwitcherRouteGroupPropTypes"},{name:"custom",raw:"separatorPropType"}]}},required:!1,description:"Array of Items to be displayed in the menu"},collapsibleGroupsThreshold:{defaultValue:{value:"15",computed:!1},type:{name:"number"},required:!1,description:"Number of items from which the groups are collapsible and the search is displayed"},hideFooter:{defaultValue:{value:"false",computed:!1},type:{name:"bool"},required:!1,description:"Prop to specify if the footer should be displayed or not"},id:{type:{name:"string"},required:!0,description:"Used to identify this component."},className:{type:{name:"string"},required:!1,description:"CSS class name for the wrapper div"},onRouteClick:{type:{name:"func"},required:!1,description:"Callback invoked when any route is clicked"},iconColor:{type:{name:"enum",computed:!0,value:"availableIconColors"},required:!1,description:"The color of trigger icon"},iconClassName:{type:{name:"string"},required:!1,description:"CSS class name for trigger icon"},footerText:{type:{name:"custom",raw:"intlMessageShape"},required:!1,description:"Text displayed on footer link"},footerUrl:{type:{name:"custom",raw:"intlMessageShape"},required:!1,description:"URL to which footer link leads"},onFooterClick:{type:{name:"func"},required:!1,description:"Callback which will be triggered when footer link is clicked"}}},renderLink.__docgenInfo={componentName:"renderLink",packageName:"@jutro/router",description:"",displayName:"renderLink",methods:[],actualName:"renderLink"},AppSwitcher.__docgenInfo={componentName:"AppSwitcher",packageName:"@jutro/router",description:"",displayName:"AppSwitcher",methods:[],actualName:"AppSwitcher",props:{id:{type:{name:"string"},required:!0,description:"Used to identify this component."},items:{type:{name:"arrayOf",value:{name:"union",value:[{name:"shape",value:{title:{name:"custom",raw:"intlMessageShape.isRequired",description:"Title that will be displayed below the icon",required:!0},to:{name:"custom",raw:"intlToShape",description:"Internal path to the application",required:!1},href:{name:"custom",raw:"intlMessageShape",description:"External path",required:!1},imageUrl:{name:"string",description:"Source of the image",required:!1},imageAlt:{name:"string",description:"Alternative text of the image",required:!1},exact:{name:"bool",description:"Flag for the exact path matching in react-router",required:!1},onClick:{name:"func",description:"Callback on item click event handler",required:!1},isFocused:{name:"bool",description:"Flag to indicate if the current item is focused",required:!1}}},{name:"shape",value:{title:{name:"custom",raw:"intlMessageShape.isRequired",description:"Title of the application group",required:!0},items:{name:"arrayOf",value:{name:"custom",raw:"appSwitcherRoutePropTypes.isRequired"},description:"Array of the route items",required:!0},isInitiallyCollapsed:{name:"bool",description:"Default state for the expandable application group",required:!1}}},{name:"shape",value:{separator:{name:"bool",required:!1}}}]}},required:!1,description:"Array of Items to be displayed in the menu",defaultValue:{value:"[]",computed:!1}},className:{type:{name:"string"},required:!1,description:"CSS class name for the wrapper div"},onRouteClick:{type:{name:"func"},required:!1,description:"Callback invoked when any route is clicked"},iconColor:{type:{name:"enum",computed:!0,value:"availableIconColors"},required:!1,description:"The color of trigger icon"},iconClassName:{type:{name:"string"},required:!1,description:"CSS class name for trigger icon"},footerText:{type:{name:"union",value:[{name:"string"},{name:"shape",value:{id:{name:"string",required:!1},defaultMessage:{name:"string",required:!1},args:{name:"shape",value:{},required:!1}}}]},required:!1,description:"Text displayed on footer link"},footerUrl:{type:{name:"union",value:[{name:"string"},{name:"shape",value:{id:{name:"string",required:!1},defaultMessage:{name:"string",required:!1},args:{name:"shape",value:{},required:!1}}}]},required:!1,description:"URL to which footer link leads"},onFooterClick:{type:{name:"func"},required:!1,description:"Callback which will be triggered when footer link is clicked"},searchEnabled:{type:{name:"bool"},required:!1,description:"Enables apps search field if the number of items equals or is above `collapsibleGroupsThreshold` value",defaultValue:{value:"true",computed:!1}},collapsibleGroupsThreshold:{type:{name:"number"},required:!1,description:"Number of items from which the groups are collapsible and the search is displayed",defaultValue:{value:"15",computed:!1}},hideFooter:{type:{name:"bool"},required:!1,description:"Prop to specify if the footer should be displayed or not",defaultValue:{value:"false",computed:!1}},isDropdown:{defaultValue:{value:"true",computed:!1},required:!1}}};